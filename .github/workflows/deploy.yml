name: deploy helm chart

on:
  push:
    branches: [ "master"]

env:
  DOCKER_REGISTRY_REPO: "${{ vars.DOCKER_HUB_REPO }}"
  

jobs:
  deployment:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: 'Deploy'
        uses: 'deliverybot/helm@v1'
        with:
          release: ${{ github.event.repository.name }}
          namespace: 'default'
          chart: 'deploy/web'
          values: |
            image:
              repository: ${{ env.DOCKER_REGISTRY_REPO }}/${{ github.event.repository.name }}
              pullPolicy: IfNotPresent
              # Overrides the image tag whose default is the chart appVersion.
              tag: "latest"
        env:
          KUBECONFIG_FILE: '${{ secrets.KUBECONFIG }}'
